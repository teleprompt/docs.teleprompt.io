<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.56">
<title data-react-helmet="true">npm publish with 2FA | Teleprompt Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="npm publish with 2FA | Teleprompt Docs"><meta data-react-helmet="true" name="description" content="Publishing an npm package with enabled two-factor auth in GitHub Actions or Travis CI"><meta data-react-helmet="true" property="og:description" content="Publishing an npm package with enabled two-factor auth in GitHub Actions or Travis CI"><meta data-react-helmet="true" name="keywords" content="npm,publish,2fa,otp,teleprompt,continuous integration,git,travis ci,github actions"><meta data-react-helmet="true" property="og:url" content="https://docs.teleprompt.io/recipes/npm-publish"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.teleprompt.io/recipes/npm-publish"><link rel="stylesheet" href="/styles.e2672f33.css">
<link rel="preload" href="/styles.0ce9eabd.js" as="script">
<link rel="preload" href="/runtime~main.c3569f93.js" as="script">
<link rel="preload" href="/main.8bb05a9b.js" as="script">
<link rel="preload" href="/common.f4f5032b.js" as="script">
<link rel="preload" href="/2.804e037f.js" as="script">
<link rel="preload" href="/14.34665279.js" as="script">
<link rel="preload" href="/15.d4de79db.js" as="script">
<link rel="preload" href="/ec1ed54d.6f529c33.js" as="script">
<link rel="preload" href="/a0745fe0.bf7a0e2b.js" as="script">
</head>
<body>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/teleprompt-white.svg" alt="Teleprompt Logo"><strong class="navbar__title">Teleprompt</strong></a><a class="navbar__item navbar__link" href="/docs/create-project">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/recipes/index">Recipes</a></div><div class="navbar__items navbar__items--right"><a href="https://teleprompt.io/dashboard" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-dashboard-link header-icon-link" aria-label="Dashboard"></a><a href="https://github.com/teleprompt" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link header-icon-link" aria-label="GitHub repository"></a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/teleprompt-white.svg" alt="Teleprompt Logo"><strong class="navbar__title">Teleprompt</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/create-project">Docs</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/recipes/index">Recipes</a></li><li class="menu__list-item"><a href="https://teleprompt.io/dashboard" target="_blank" rel="noopener noreferrer" class="menu__link header-dashboard-link header-icon-link" aria-label="Dashboard"></a></li><li class="menu__list-item"><a href="https://github.com/teleprompt" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link header-icon-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Recipes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/recipes/index">Overview</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/recipes/npm-publish">npm publish with 2FA</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">npm publish with 2FA</h1></header><div class="markdown"><p>Let&#x27;s put teleprompt to good use and publish an npm package every time we create a new git tag ðŸš€</p><p>What&#x27;s so special about that? It will work with the secure on-publish two-factor authentication (2FA) setting enabled on our npm account. We shall use teleprompt.io to ask you for the 2FA token whenever we are about to publish.</p><p>The additional benefit is that you can rest assured that the CI can never publish without your consent as it lacks half of the credentials. You will receive a notification and authorize every <code>npm publish</code> in a few seconds.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="getting-the-keys"></a>Getting the keys<a aria-hidden="true" tabindex="-1" class="hash-link" href="#getting-the-keys" title="Direct link to heading">#</a></h2><p>Our goal is to publish when a new git tag is pushed or a new release is created in GitHub. Let&#x27;s start by logging in to <a href="https://npmjs.com">npmjs.com</a> and <a href="https://teleprompt.io/dashboard" target="_blank" rel="noopener noreferrer">teleprompt.io</a> to collect our credentials.</p><p>First, let&#x27;s log in to npmjs.com and check out the <code>Auth Tokens</code> settings page. Create a new token with publishing rights and keep the actual token at hand. You might also want to check our two-factor auth settings while you are here.</p><p>Secondly, log in to the <a href="https://teleprompt.io/dashboard" target="_blank" rel="noopener noreferrer">Teleprompt Dashboard</a>. Choose <code>Projects</code> from the main menu on the left and create a new project for your repository. After choosing an arbitrary name and submitting the project creation form, an API key will be created for you automatically. Keep this API key at hand, too.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="github-actions"></a>GitHub Actions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#github-actions" title="Direct link to heading">#</a></h2><p>Read here how to set up automatic publishing in GitHub Actions now. You can find instructions for other CI environments below.</p><p>Head over to your GitHub repository&#x27;s settings and <a href="https://help.github.com/en/actions/configuring-and-managing-workflows/creating-and-storing-encrypted-secrets#creating-encrypted-secrets-for-a-repository" target="_blank" rel="noopener noreferrer">create the following secrets</a>:</p><ul><li><code>NPM_TOKEN</code> â€“ Your npm authentication token</li><li><code>TELEPROMPT_KEY</code> â€“ Your teleprompt API key</li></ul><p>Let&#x27;s <a href="https://help.github.com/en/actions/configuring-and-managing-workflows/configuring-a-workflow#creating-a-workflow-file" target="_blank" rel="noopener noreferrer">create a new workflow now</a>. We will call the workflow file <code>build.yml</code> and start with an empty workflow file.</p><p>Paste the following workflow configuration into our new workflow.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># This is a basic workflow to help you get started with Actions</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> npm package CI</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Controls when the action will run. Triggers the workflow on push or pull request</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># events but only for the master branch</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">on</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> master </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">release</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">types</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">created</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># A workflow run is made up of one or more jobs that can run sequentially or in parallel</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">jobs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># This workflow contains a single job called &quot;build&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">build</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># The type of runner that the job will run on</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">runs-on</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">latest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Steps represent a sequence of tasks that will be executed as part of the job</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">steps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> actions/setup</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">node@v1.4.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">with</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">node-version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 12.x</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Checkout</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> actions/checkout@v2.2.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Install</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> npm ci</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Test</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> npm test</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Publish</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> npm publish</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token scalar string" style="color:rgb(195, 232, 141)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        echo &quot;//registry.npmjs.org/:_authToken=\${NPM_TOKEN}&quot; &gt; .npmrc</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        npm version from-git --allow-same-version</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        npm publish $(npx teleprompt --output-format cli --prompt &quot;otp:otp:2FA Token&quot;)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">NPM_TOKEN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> secrets.NPM_TOKEN </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">TELEPROMPT_KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> secrets.TELEPROMPT_KEY </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>The last few lines is where the magic happens: We use <code>npx</code> to download and run the <code>teleprompt</code> client and use it to feed the <code>otp</code> option to <code>npm publish</code>. You can find the details how to use the teleprompt command line client <a href="/docs/cli-client-usage">here</a>.</p><p>That&#x27;s it! Try to create a tag / release in GitHub â€“ once the last job in the workflow is run, you should receive an email from teleprompt.io, asking you to provide the required information.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="travis-ci"></a>Travis CI<a aria-hidden="true" tabindex="-1" class="hash-link" href="#travis-ci" title="Direct link to heading">#</a></h2><p>We assume you have already added your repository to Travis CI. Let&#x27;s open it and head over to the Travis CI settings for this repository. Under &quot;Environment Variables&quot; make sure to add your secrets:</p><ul><li><code>NPM_TOKEN</code> â€“ Your npm authentication token</li><li><code>TELEPROMPT_KEY</code> â€“ Your teleprompt API key</li></ul><p>Do not restrict these secret environment variables to certain branches as we will build per git tag and Travis CI won&#x27;t associate the tag with the branch you tagged.</p><p>Create a <code>.travis.yml</code> file with the following content.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">language</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> node_js</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">cache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> npm</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">node_js</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;12&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">stages</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> test</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> publish</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> tag =~ /^v</span><span class="token punctuation" style="color:rgb(199, 146, 234)">?</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">+\.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">+\.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">jobs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">include</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">stage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> test</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">script</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> npm test</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">stage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> publish</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">before_script</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> echo &quot;//registry.npmjs.org/</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">_authToken=\$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">NPM_TOKEN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&quot; </span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> .npmrc</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">script</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> npm version $(echo $TRAVIS_TAG </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token plain"> sed s/^v//) </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">allow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">same</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">version</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> npm publish $(npx teleprompt </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">output</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">format cli </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">prompt &quot;otp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">otp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">2FA Token&quot;)</span></div></div></div></div></div><p>That&#x27;s it! Try to create a tag and wait for the build to reach the <code>npm publish</code> step. You should receive an email from teleprompt.io, asking you to provide the required information.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="other-ci-providers"></a>Other CI providers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#other-ci-providers" title="Direct link to heading">#</a></h2><p>There are of course more CI providers, like GitLab CI, Circle CI, Jenkins CI, Atlassian Bamboo, AppVeyor and others.</p><p>We will not go into details for all those CI providers, but the setup is generally very similar in all of them. Check out the examples above and your CI tool&#x27;s documentation to create your own setup.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="why-is-on-publish-2fa-so-important"></a>Why is on-publish 2FA so important?<a aria-hidden="true" tabindex="-1" class="hash-link" href="#why-is-on-publish-2fa-so-important" title="Direct link to heading">#</a></h2><p>Without teleprompt.io there is hardly a simple way to achieve the setup outlined above. It is trivial to create a similar setup if the npm 2FA setting is set to auth-only, but that this option provides insufficient security for publishing in CI.</p><p>There are multiple ways how a malicious actor could obtain your npm authentication token from your CI environment. For instance, the npm token environment variable might be set when running the tests for an externally-contributed pull request due to some simple misconfiguration. Alternatively, your CI provider might suffer from an information expose vulnerability that reveals environment variables or files.</p><p>In case of two-factor authentication being disabled or auth-only only, an attacker who got hold of your npm authentication token is immediately able to publish new versions containing arbitrary code.</p><p>Not so with on-publish 2FA: In order to publish to npm you still need the current 2FA token. Even if the attacker also obtained the teleprompt API key from your CI environment, they <strong>can only use it to ask you for the 2FA token</strong>.</p><p>That&#x27;s what makes this setup so secure: Even in the worst case scenario you are still in charge of the credentials.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/teleprompt/docs.teleprompt.io/edit/master/docs/recipes/npm-publish.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/recipes/index"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Overview</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#getting-the-keys" class="table-of-contents__link">Getting the keys</a></li><li><a href="#github-actions" class="table-of-contents__link">GitHub Actions</a></li><li><a href="#travis-ci" class="table-of-contents__link">Travis CI</a></li><li><a href="#other-ci-providers" class="table-of-contents__link">Other CI providers</a></li><li><a href="#why-is-on-publish-2fa-so-important" class="table-of-contents__link">Why is on-publish 2FA so important?</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>Copyright Â© 2021 Next Step Software UG (haftungsbeschrÃ¤nkt). Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.0ce9eabd.js"></script>
<script src="/runtime~main.c3569f93.js"></script>
<script src="/main.8bb05a9b.js"></script>
<script src="/common.f4f5032b.js"></script>
<script src="/2.804e037f.js"></script>
<script src="/14.34665279.js"></script>
<script src="/15.d4de79db.js"></script>
<script src="/ec1ed54d.6f529c33.js"></script>
<script src="/a0745fe0.bf7a0e2b.js"></script>
</body>
</html>